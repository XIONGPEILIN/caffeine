☕ 咖啡因代谢与脑力状态计算器 (Caffeine & Cognitive State Calculator)1. 项目概述本项目是一个基于 Web 的智能健康工具，旨在帮助用户科学管理咖啡因摄入。与传统的残留计算器不同，本系统引入了睡眠稳态模型 (Process S) 来模拟大脑疲劳度，并采用睡眠预算倒推算法来生成既能维持精力又能保护睡眠的摄入计划。2. 核心科学模型本系统采用双层评估模型，同时计算“物理残留”与“有效感知”两条曲线。2.1 药代动力学 (PK) - 物理残留用于计算血液中实际存在的咖啡因含量。这是判断是否影响入睡的唯一标准。公式 (一级消除动力学):$$C_t = C_0 \times (0.5)^{\frac{t}{t_{1/2}}}$$$C_t$: 经过时间 $t$ 后的体内残留量 (mg)。$C_0$: 初始摄入量 (mg)。$t_{1/2}$: 用户的代谢半衰期 (通常为 3-7 小时，受 CYP1A2 基因影响)。2.2 睡眠稳态模型 (Process S) - 大脑疲劳度用于模拟清醒期间大脑腺苷 (Adenosine) 的堆积过程。腺苷是导致“困倦”的生理基础，它会抑制咖啡因的提神效果（通过竞争性结合受体）。公式 (Borbély 双过程模型):$$S(t) = 1 - e^{-\frac{t}{\chi_w}}$$$S(t)$:  $t$ 时刻的睡眠压力/腺苷水平 (归一化 0-1)。$t$: 距离起床的时间 (小时)。$\chi_w$: 压力增长的时间常数。本模型采用成人标准值 $\approx 18.2$ 小时 [1]。2.3 有效感知浓度 (Effective Perception)用于判断是否需要补给。这是修正了疲劳度后，大脑实际感受到的提神强度。逻辑:随着清醒时间延长，腺苷受体被占用的比例增加，相同剂量的咖啡因产生的拮抗作用（提神感）会被打折。计算:$$E_{level} = C_{physical} \times (1 - \text{FatiguePenalty}(S_t))$$3. 智能规划算法：睡眠预算与分级回填系统摒弃了简单的线性规划，采用了更符合人类行为习惯的回溯与维持策略。3.1 睡眠预算 (Sleep Budgeting)在规划任何一杯咖啡前，算法首先计算安全边界：$$Budget = \text{SleepThreshold} (50mg) - \text{ResidualAtSleep}$$系统严格保证所有摄入在预定入睡时刻的物理残留总和不超过 $50mg$。3.2 补给策略逻辑当检测到“有效感知浓度”低于用户设定的最低线 (Min Focus) 时，触发补给判断：标准单位优先 (Standard Unit First):首先尝试在当前时刻添加 1份标准饮品（用户设定的最小单位）。如果该操作未突破睡眠预算，则执行添加，并推进时间。分级回填 (Tiered Backfill):如果当前时刻喝1份会导致失眠，算法不会建议喝“半份”或“放弃”，而是尝试回溯过去。逻辑: 早期摄入的咖啡因到睡前代谢得更多，因此加浓早期的咖啡比现在新喝一杯更安全。执行顺序:Tier 1: 查找最近一次 1.0倍 的记录 $\rightarrow$ 升级为 1.5倍。Tier 2: 若失败，查找最近一次 1.5倍 的记录 $\rightarrow$ 升级为 2.0倍。Tier 3: 若失败，查找最近一次 2.0倍 的记录 $\rightarrow$ 升级为 2.5倍 (封顶)。此策略确保了补给方案既能维持全天状态平稳（Fill-Up Strategy），又严格遵守睡眠红线。4. 参考文献 (References)本项目的算法模型主要基于以下神经科学与药理学文献：Process S (Sleep Homeostasis):Borbély, A. A. (1982). A two process model of sleep regulation. Human neurobiology, 1(3), 195-204.Achermann, P., & Borbély, A. A. (2003). Mathematical models of sleep regulation. Frontiers in Bioscience, 8(1), 683-693. (Defining the time constant $\chi_w \approx 18.2h$).Caffeine Pharmacokinetics (PK):Fredholm, B. B., et al. (1999). Actions of caffeine in the brain with special reference to factors that contribute to its widespread use. Pharmacological reviews, 51(1), 83-133.Nehlig, A. (2018). Interindividual differences in caffeine metabolism and factors driving caffeine consumption. Pharmacological reviews, 70(2), 384-411.Adenosine-Caffeine Interaction:Landolt, H. P. (2008). "Sleep homeostasis: A role for adenosine in humans?". Biochemical Pharmacology, 75(11), 2070-2079.5. 预计更新：预测警觉度 (Future Roadmap: Alertness Prediction)为了进一步提高预测精度，我们计划引入昼夜节律 (Process C)，将当前框架升级为警觉度三过程模型 (Three-Process Model of Alertness, TPMA)。这将弥补当前模型无法模拟“午后低谷”的局限性。5.1 昼夜节律 (Process C)模拟人体生物钟的自然振荡过程。它独立于睡眠历史，在白天促进觉醒，在夜晚促进睡眠。拟定公式:$$C(t) = A \sin(\frac{2\pi}{\tau}(t - \phi))$$$C(t)$: 昼夜节律对警觉度的贡献值。$\tau$: 周期，固定为 24 小时。$\phi$: 相位，取决于用户的起床时间或个人的早起/晚睡偏好 (Chronotype)。5.2 综合警觉度预测 (TPMA)未来的警觉度评分将综合考虑物理残留、睡眠压力和昼夜节律的相互作用：$$\text{Alertness}(t) = \text{Baseline} + C(t) - S(t) + E_{caffeine}(t)$$引入 Process C 后，系统将能更精准地识别以下生理窗口：午后低谷 (Afternoon Dip): 约 14:00-16:00，此时 $C(t)$ 处于低谷，可能需要额外的咖啡因支持。睡眠禁区 (Forbidden Zone): 睡前 2-3 小时，此时 $C(t)$ 处于峰值，即使腺苷很高也难以入睡。6. 技术栈Core: HTML5, JavaScript (ES6+)Styling: Tailwind CSS (CDN)Visualization: Chart.jsStorage: Browser LocalStorage (Data persistence without backend)
